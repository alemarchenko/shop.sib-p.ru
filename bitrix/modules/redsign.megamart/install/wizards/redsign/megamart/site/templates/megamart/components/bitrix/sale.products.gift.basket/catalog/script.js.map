{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["export class JCSaleProductsGiftBasketMegamart\n{\n\tconstructor (params)\n\t{\n\t\tthis.formPosting = false;\n\t\tthis.siteId = params.siteId || '';\n\t\tthis.template = params.template || '';\n\t\tthis.componentPath = params.componentPath || '';\n\t\tthis.parameters = params.parameters || '';\n\n\t\tthis.container = document.querySelector('[data-entity=\"' + params.container + '\"]');\n\t\tthis.currentProductId = params.currentProductId;\n\n\t\tif (params.initiallyShowHeader)\n\t\t{\n\t\t\tBX.ready(BX.proxy(this.showHeader, this));\n\t\t}\n\n\t\tif (params.deferredLoad)\n\t\t{\n\t\t\tBX.ready(BX.proxy(this.deferredLoad, this));\n\t\t}\n\n\t\tBX.addCustomEvent('OnBasketChange', BX.proxy(this.reloadGifts, this));\n\t\tBX.addCustomEvent('OnCouponApply', BX.proxy(this.reloadGifts, this));\n\t}\n\n\treloadGifts()\n\t{\n\t\tthis.sendRequest({action: 'deferredLoad', recalculateDiscounts: 'Y'});\n\t}\n\n\tdeferredLoad()\n\t{\n\t\tthis.sendRequest({action: 'deferredLoad'});\n\t}\n\n\tsendRequest(data)\n\t{\n\t\tvar defaultData = {\n\t\t\tsiteId: this.siteId,\n\t\t\ttemplate: this.template,\n\t\t\tparameters: this.parameters\n\t\t};\n\n\t\tBX.ajax({\n\t\t\turl: this.componentPath + '/ajax.php' + (document.location.href.indexOf('clear_cache=Y') !== -1 ? '?clear_cache=Y' : ''),\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\ttimeout: 60,\n\t\t\tdata: BX.merge(defaultData, data),\n\t\t\tonsuccess: BX.delegate(function(result){\n\t\t\t\tif (!result || !result.JS)\n\t\t\t\t{\n\t\t\t\t\tthis.hideHeader();\n\t\t\t\t\tBX.cleanNode(this.container);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tBX.ajax.processScripts(\n\t\t\t\t\tBX.processHTML(result.JS).SCRIPT,\n\t\t\t\t\tfalse,\n\t\t\t\t\tBX.delegate(function(){this.showAction(result, data);}, this)\n\t\t\t\t);\n\t\t\t}, this)\n\t\t});\n\t}\n\n\tshowAction(result, data)\n\t{\n\t\tif (!data)\n\t\t\treturn;\n\n\t\tswitch (data.action)\n\t\t{\n\t\t\tcase 'deferredLoad':\n\t\t\t\tthis.processDeferredLoadAction(result);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprocessDeferredLoadAction(result)\n\t{\n\t\tif (!result)\n\t\t\treturn;\n\n\t\tthis.processItems(result.items);\n\t}\n\n\tprocessItems(itemsHtml)\n\t{\n\t\tif (!itemsHtml)\n\t\t\treturn;\n\n\t\tvar processed = BX.processHTML(itemsHtml, false),\n\t\t\ttemporaryNode = BX.create('DIV');\n\n\t\tvar items, k, origRows;\n\n\t\ttemporaryNode.innerHTML = processed.HTML;\n\n\t\torigRows = this.container.querySelectorAll('[data-entity=\"items-row\"]');\n\t\tif (origRows.length)\n\t\t{\n\t\t\tBX.cleanNode(this.container);\n\t\t\tthis.showHeader(false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showHeader(true);\n\t\t}\n\n\t\titems = temporaryNode.querySelectorAll('[data-entity=\"items-row\"]');\n\t\tfor (k in items)\n\t\t{\n\t\t\tif (items.hasOwnProperty(k))\n\t\t\t{\n\t\t\t\titems[k].style.opacity = 0;\n\t\t\t\tthis.container.appendChild(items[k]);\n\t\t\t}\n\t\t}\n\n\t\tnew BX.easing({\n\t\t\tduration: 2000,\n\t\t\tstart: {opacity: 0},\n\t\t\tfinish: {opacity: 100},\n\t\t\ttransition: BX.easing.makeEaseOut(BX.easing.transitions.quad),\n\t\t\tstep: function(state){\n\t\t\t\tfor (var k in items)\n\t\t\t\t{\n\t\t\t\t\tif (items.hasOwnProperty(k))\n\t\t\t\t\t{\n\t\t\t\t\t\titems[k].style.opacity = state.opacity / 100;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcomplete: function(){\n\t\t\t\tfor (var k in items)\n\t\t\t\t{\n\t\t\t\t\tif (items.hasOwnProperty(k))\n\t\t\t\t\t{\n\t\t\t\t\t\titems[k].removeAttribute('style');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}).animate();\n\n\t\tBX.ajax.processScripts(processed.SCRIPT);\n\t}\n\n\tshowHeader(animate)\n\t{\n\t\tvar parentNode = BX.findParent(this.container, {attr: {'data-entity': 'parent-container'}}),\n\t\t\theader;\n\n\t\tif (parentNode && BX.type.isDomNode(parentNode))\n\t\t{\n\t\t\tparentNode.style.display = '';\n\t\t\theader = parentNode.querySelector('[data-entity=\"header\"]');\n\n\t\t\tif (header && header.getAttribute('data-showed') === 'false')\n\t\t\t{\n\t\t\t\theader.style.display = '';\n\n\t\t\t\tif (animate)\n\t\t\t\t{\n\t\t\t\t\tthis.animation = new BX.easing({\n\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t\tstart: {opacity: 0},\n\t\t\t\t\t\tfinish: {opacity: 100},\n\t\t\t\t\t\ttransition: BX.easing.makeEaseOut(BX.easing.transitions.quad),\n\t\t\t\t\t\tstep: function(state){\n\t\t\t\t\t\t\theader.style.opacity = state.opacity / 100;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcomplete: function(){\n\t\t\t\t\t\t\theader.removeAttribute('style');\n\t\t\t\t\t\t\theader.setAttribute('data-showed', 'true');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.animation.animate()\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\theader.style.opacity = 100;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thideHeader()\n\t{\n\t\tvar parentNode = BX.findParent(this.container, {attr: {'data-entity': 'parent-container'}}),\n\t\t\theader;\n\n\t\tif (parentNode && BX.type.isDomNode(parentNode))\n\t\t{\n\t\t\theader = parentNode.querySelector('[data-entity=\"header\"]');\n\n\t\t\tif (header)\n\t\t\t{\n\t\t\t\tif (this.animation)\n\t\t\t\t{\n\t\t\t\t\tthis.animation.stop();\n\t\t\t\t}\n\n\t\t\t\theader.style.display = 'none';\n\t\t\t\theader.style.opacity = 0;\n\t\t\t\theader.setAttribute('data-showed', 'false');\n\t\t\t}\n\t\t}\n\t}\n}"],"names":["JCSaleProductsGiftBasketMegamart","params","formPosting","siteId","template","componentPath","parameters","container","document","querySelector","currentProductId","initiallyShowHeader","BX","ready","proxy","showHeader","deferredLoad","addCustomEvent","reloadGifts","sendRequest","action","recalculateDiscounts","data","defaultData","ajax","url","location","href","indexOf","method","dataType","timeout","merge","onsuccess","delegate","result","JS","hideHeader","cleanNode","processScripts","processHTML","SCRIPT","showAction","processDeferredLoadAction","processItems","items","itemsHtml","processed","temporaryNode","create","k","origRows","innerHTML","HTML","querySelectorAll","length","hasOwnProperty","style","opacity","appendChild","easing","duration","start","finish","transition","makeEaseOut","transitions","quad","step","state","complete","removeAttribute","animate","parentNode","findParent","attr","header","type","isDomNode","display","getAttribute","animation","setAttribute","stop"],"mappings":"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"}